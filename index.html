<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>Suno æ­Œè©ãƒ¡ãƒ¢ï¼ˆãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼‰</title>
<style>
  :root{
    --bg:#0b0b0c; --panel:#111214; --muted:#9aa2a8; --accent:#4fb0a6; --card:#0f1112; --border:#222427;
    --shadow: 0 6px 18px rgba(0,0,0,0.6);
    --text:#fff;
  }
  html,body{height:100%; margin:0; font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN","Noto Sans JP","Helvetica Neue", Arial; background:var(--bg); color:var(--text); -webkit-text-size-adjust:100%;}
  header{display:flex; align-items:center; gap:8px; padding:10px; border-bottom:1px solid var(--border); background:var(--panel); position:relative; z-index:5;}
  .title{font-weight:700;}
  .top-actions{margin-left:auto; display:flex; gap:8px; align-items:center;}
  button{font-family:inherit}
  .small-btn{padding:6px 8px; background:transparent; color:var(--text); border:1px solid var(--border); border-radius:6px; cursor:pointer;}
  .icon-btn{font-size:16px; line-height:1; padding:6px; border-radius:6px; border:0; background:transparent; color:var(--text); cursor:pointer;}
  .container{display:flex; height:calc(100vh - 56px);}
  .sidebar{width:260px; min-width:200px; max-width:320px; border-right:1px solid var(--border); background:var(--card); padding:10px; box-sizing:border-box; overflow:auto;}
  .notes-list{display:flex; flex-direction:column; gap:8px;}
  .note-item{background:transparent; padding:8px; border-radius:8px; border:1px solid var(--border); cursor:pointer; display:flex; justify-content:space-between; align-items:center;}
  .note-item.active{outline:2px solid rgba(79,176,166,0.12);}
  .editor{flex:1; display:flex; flex-direction:column; min-width:0;}
  .lyrics{display:flex; gap:8px; padding:10px; height:calc(100% - 120px); box-sizing:border-box;}
  .lyric-box{flex:1; display:flex; flex-direction:column; border-radius:8px; background:var(--panel); border:1px solid var(--border); box-shadow:var(--shadow); overflow:hidden;}
  .lyric-header{display:flex; align-items:center; justify-content:space-between; padding:8px; border-bottom:1px solid var(--border); color:var(--muted);}
  textarea{background:transparent; color:var(--text); border:0; resize:none; padding:10px; box-sizing:border-box; font-size:16px; line-height:1.6; -webkit-font-smoothing:antialiased;}
  /* IMPORTANT: keep textarea font-size >=16px to avoid iOS auto-zoom */
  .lyric-text{flex:1; min-height:220px; outline:none; }
  .bottom{display:flex; gap:8px; padding:10px; border-top:1px solid var(--border); background:var(--panel); align-items:center;}
  input[type="text"]{background:transparent; color:var(--text); border:1px solid var(--border); padding:8px; border-radius:6px;}
  .glossary-page{display:none;}
  .glossary-panel{padding:12px; overflow:auto; height:100%; background:var(--panel); color:var(--text);}
  .g-card{background:transparent; border:1px solid var(--border); padding:10px; border-radius:8px; margin-bottom:10px;}
  .g-title{font-weight:700; margin-bottom:6px; color:var(--accent);}
  .term{padding:6px 8px; border-radius:6px; cursor:pointer; display:inline-block; background:#111316; border:1px solid #1d2022; color:var(--text); margin:4px 6px 4px 0;}
  .term .eng{font-weight:700; color:var(--text);}
  .term .jpn{display:block; font-size:13px; color:var(--muted); margin-top:4px;}
  .copy-notice{position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:#111; color:#fff; padding:8px 12px; border-radius:20px; opacity:0; transition:opacity .2s;}
  .top-nav{display:flex; gap:8px; align-items:center;}
  @media (max-width:900px){
    .sidebar{display:none;}
    .container{flex-direction:column;}
    .lyrics{height:calc(100% - 160px);}
  }
</style>
</head>
<body>

<header>
  <div class="title">Suno æ­Œè©ãƒ¡ãƒ¢ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰</div>

  <div class="top-actions">
    <button id="prevNote" class="small-btn" title="å‰ã®ãƒãƒ¼ãƒˆã¸">â†</button>
    <button id="nextNote" class="small-btn" title="æ¬¡ã®ãƒãƒ¼ãƒˆã¸">â†’</button>

    <button id="openGlossNewTab" class="small-btn" title="ç”¨èªé›†ã‚’åˆ¥ã‚¿ãƒ–ã§é–‹ã">ç”¨èªé›†ï¼ˆåˆ¥ã‚¿ãƒ–ï¼‰</button>
    <button id="jumpGloss" class="small-btn" title="ã“ã®ãƒšãƒ¼ã‚¸å†…ã§ç”¨èªé›†ã¸ã‚¸ãƒ£ãƒ³ãƒ—">ç”¨èªé›†ã¸</button>

    <div style="width:8px"></div>

    <span id="currentName" style="font-size:14px;color:var(--muted)">ï¼ˆæœªé¸æŠï¼‰</span>

    <div style="width:10px"></div>

    <button id="exportAll" class="small-btn" title="å…¨ãƒãƒ¼ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    <label class="small-btn" title="ãƒãƒ¼ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ">
      ã‚¤ãƒ³ãƒãƒ¼ãƒˆ <input id="importFile" style="display:none" type="file" accept="application/json">
    </label>
  </div>
</header>

<div class="container">
  <aside class="sidebar" id="sidebar">
    <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px;">
      <input id="newNoteName" placeholder="æ–°ã—ã„ãƒãƒ¼ãƒˆå" type="text" style="flex:1">
      <button id="createNote" class="small-btn">ä½œæˆ</button>
    </div>

    <div class="notes-list" id="notesList" aria-live="polite"></div>
  </aside>

  <main class="editor">
    <div class="lyrics">
      <div class="lyric-box" id="box1">
        <div class="lyric-header">
          <div style="font-weight:700">â‘  1ç•ªï¼ˆå·¦ï¼‰</div>
          <div>
            <button id="copyVerse1" class="icon-btn" title="ã‚³ãƒ”ãƒ¼ï¼ˆ1ç•ªï¼‰">â</button>
            <button id="clearVerse1" class="icon-btn" title="æ¶ˆå»ï¼ˆ1ç•ªï¼‰">ğŸ—‘ï¸</button>
          </div>
        </div>
        <textarea id="verse1" class="lyric-text" placeholder="1ç•ªã®æ­Œè©ã‚’ã“ã“ã«æ›¸ã" spellcheck="false" autocapitalize="off"></textarea>
      </div>

      <div class="lyric-box" id="box2">
        <div class="lyric-header">
          <div style="font-weight:700">â‘¡ 2ç•ªï¼ˆå³ï¼‰</div>
          <div>
            <button id="copyVerse2" class="icon-btn" title="ã‚³ãƒ”ãƒ¼ï¼ˆ2ç•ªï¼‰">â</button>
            <button id="clearVerse2" class="icon-btn" title="æ¶ˆå»ï¼ˆ2ç•ªï¼‰">ğŸ—‘ï¸</button>
          </div>
        </div>
        <textarea id="verse2" class="lyric-text" placeholder="2ç•ªã®æ­Œè©ã‚’ã“ã“ã«æ›¸ã" spellcheck="false" autocapitalize="off"></textarea>
      </div>
    </div>

    <div class="bottom">
      <div style="font-size:13px; color:var(--muted);">æ“ä½œ</div>
      <div style="flex:1"></div>
      <button id="renameNote" class="small-btn" title="ãƒãƒ¼ãƒˆåã‚’å¤‰æ›´">âœ</button>
      <button id="deleteNote" class="small-btn" title="ãƒãƒ¼ãƒˆå‰Šé™¤ï¼ˆç¢ºèªã‚ã‚Šï¼‰">ğŸ—‘ï¸ ãƒãƒ¼ãƒˆå‰Šé™¤</button>
      <button id="downloadNote" class="small-btn" title="ç¾åœ¨ã®ãƒãƒ¼ãƒˆã‚’ä¿å­˜ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰">ä¿å­˜</button>
    </div>
  </main>
</div>

<!-- glossary area (same file, jump with #glossary or button) -->
<section id="glossarySection" class="glossary-panel" style="display:none">
  <div style="padding:12px;">
    <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
      <button id="backToEditor" class="small-btn">â† æˆ»ã‚‹</button>
      <div style="font-weight:700; color:var(--accent)">éŸ³æ¥½ç”¨èªé›†ï¼ˆã‚¿ãƒƒãƒ—ã§ã‚³ãƒ”ãƒ¼ï¼‰</div>
      <input id="glossSearch" placeholder="æ¤œç´¢ï¼ˆè‹±èª/æ—¥æœ¬èªï¼‰" style="margin-left:auto; padding:8px; border-radius:6px; border:1px solid var(--border); background:transparent; color:var(--text)">
    </div>

    <div id="glossary" style="max-height:70vh; overflow:auto"></div>
  </div>
</section>

<div class="copy-notice" id="copyNotice">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

<script>
/* ========== storage & notes ========== */
const STORAGE_KEY = 'suno_memo_notes_v2';
let notes = [];
let currentId = null;

function initNotes(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    try { notes = JSON.parse(raw); } catch(e){ notes=[]; }
  }
  if(!notes || notes.length===0){
    const now = Date.now();
    notes = [{ id:'note-'+now, name:'æ–°ã—ã„ãƒãƒ¼ãƒˆ', verse1:'', verse2:'', updated:now }];
    currentId = notes[0].id;
    saveAll();
  } else {
    notes.sort((a,b)=> b.updated - a.updated);
    currentId = notes[0].id;
  }
}

function saveAll(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
  renderNotesList();
  updateCurrentName();
}

function getCurrentNote(){ return notes.find(n=>n.id===currentId) || null; }

function updateCurrentName(){
  const n = getCurrentNote();
  document.getElementById('currentName').textContent = n ? n.name : 'ï¼ˆæœªé¸æŠï¼‰';
}

/* render list */
const notesListEl = document.getElementById('notesList');
function renderNotesList(){
  notesListEl.innerHTML = '';
  notes.sort((a,b)=> b.updated - a.updated).forEach(n=>{
    const div = document.createElement('div');
    div.className = 'note-item' + (n.id===currentId ? ' active' : '');
    div.innerHTML = `<div style="flex:1;"><strong style="color:var(--text)">${escapeHtml(n.name)}</strong>
      <div style="font-size:12px;color:${'#9aa2a8'}">${new Date(n.updated).toLocaleString()}</div></div>
      <div style="display:flex; gap:6px; align-items:center;">
        <button class="small-btn" data-id="${n.id}" data-action="open" title="é–‹ã">é–‹</button>
        <button class="small-btn" data-id="${n.id}" data-action="dup" title="è¤‡è£½">è¤‡è£½</button>
      </div>`;
    notesListEl.appendChild(div);
  });
}

/* helpers */
function escapeHtml(str){ return (str||'').replace(/[<>&"]/g,(c)=>({ '<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;' })[c]); }

/* create note */
document.getElementById('createNote').addEventListener('click', ()=>{
  const name = document.getElementById('newNoteName').value.trim() || 'æ–°ã—ã„ãƒãƒ¼ãƒˆ';
  const id = 'note-'+Date.now();
  const n = {id, name, verse1:'', verse2:'', updated:Date.now()};
  notes.push(n); currentId = id; saveAll(); loadCurrentToEditor();
  document.getElementById('newNoteName').value = '';
});

/* list click handler */
notesListEl.addEventListener('click', (e)=>{
  const btn = e.target.closest('button'); if(!btn) return;
  const id = btn.dataset.id; const action = btn.dataset.action;
  if(action==='open'){ currentId = id; loadCurrentToEditor(); }
  if(action==='dup'){ const orig = notes.find(x=>x.id===id); if(orig){ const copy={...orig,id:'note-'+Date.now(),name:orig.name+'ï¼ˆè¤‡è£½ï¼‰',updated:Date.now()}; notes.push(copy); currentId=copy.id; saveAll(); loadCurrentToEditor(); } }
});

/* rename, delete */
document.getElementById('renameNote').addEventListener('click', ()=>{
  const n = getCurrentNote(); if(!n) return alert('ãƒãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„');
  const nm = prompt('ãƒãƒ¼ãƒˆåã‚’å…¥åŠ›', n.name); if(nm!==null){ n.name = nm || 'ç„¡é¡Œ'; n.updated = Date.now(); saveAll(); loadCurrentToEditor(); }
});
document.getElementById('deleteNote').addEventListener('click', ()=>{
  const n = getCurrentNote(); if(!n) return alert('ãƒãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„');
  if(!confirm('æœ¬å½“ã«ã“ã®ãƒãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
  notes = notes.filter(x=>x.id!==n.id);
  if(notes.length===0){ const now=Date.now(); notes=[{id:'note-'+now,name:'æ–°ã—ã„ãƒãƒ¼ãƒˆ',verse1:'',verse2:'',updated:now}]; }
  currentId = notes[0].id; saveAll(); loadCurrentToEditor();
});

/* download & export & import */
document.getElementById('downloadNote').addEventListener('click', ()=>{
  const n = getCurrentNote(); if(!n) return;
  const data = JSON.stringify(n,null,2); const blob = new Blob([data], {type:'application/json'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = (n.name||'note') + '.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
document.getElementById('exportAll').addEventListener('click', ()=>{
  const data = JSON.stringify(notes,null,2); const blob = new Blob([data], {type:'application/json'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'suno_memo_all.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
document.getElementById('importFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return; const reader = new FileReader();
  reader.onload = ()=>{ try{ const loaded = JSON.parse(reader.result);
    if(Array.isArray(loaded)){ notes = loaded; currentId = notes[0]?.id || null; saveAll(); loadCurrentToEditor(); alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†'); }
    else if(loaded && loaded.id){ notes.push(loaded); currentId = loaded.id; saveAll(); loadCurrentToEditor(); alert('ãƒãƒ¼ãƒˆè¿½åŠ '); }
    else alert('ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™'); }catch(err){ alert('èª­ã¿è¾¼ã¿å¤±æ•—: '+err.message); } };
  reader.readAsText(f);
});

/* load current */
const verse1 = document.getElementById('verse1');
const verse2 = document.getElementById('verse2');
function loadCurrentToEditor(){
  const n = getCurrentNote(); if(!n) return;
  verse1.value = n.verse1 || ''; verse2.value = n.verse2 || ''; updateCurrentName(); renderNotesList();
}

/* auto-save debounce */
let saveTimer = null;
[verse1,verse2].forEach(el=>{
  el.addEventListener('input', ()=>{
    if(!currentId) return;
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(()=>{ const n = getCurrentNote(); if(!n) return; n.verse1 = verse1.value; n.verse2 = verse2.value; n.updated = Date.now(); saveAll(); }, 500);
  });
});

/* copy & clear with confirmation */
document.getElementById('copyVerse1').addEventListener('click', ()=> {
  navigator.clipboard.writeText(verse1.value || '').then(()=> showCopyNotice('1ç•ªã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
});
document.getElementById('copyVerse2').addEventListener('click', ()=> {
  navigator.clipboard.writeText(verse2.value || '').then(()=> showCopyNotice('2ç•ªã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
});
document.getElementById('clearVerse1').addEventListener('click', ()=>{
  if(!verse1.value) return showCopyNotice('1ç•ªã¯æ—¢ã«ç©ºã§ã™');
  if(confirm('1ç•ªã®å†…å®¹ã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')){ verse1.value=''; verse1.dispatchEvent(new Event('input')); showCopyNotice('1ç•ªã‚’æ¶ˆå»ã—ã¾ã—ãŸ'); }
});
document.getElementById('clearVerse2').addEventListener('click', ()=>{
  if(!verse2.value) return showCopyNotice('2ç•ªã¯æ—¢ã«ç©ºã§ã™');
  if(confirm('2ç•ªã®å†…å®¹ã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')){ verse2.value=''; verse2.dispatchEvent(new Event('input')); showCopyNotice('2ç•ªã‚’æ¶ˆå»ã—ã¾ã—ãŸ'); }
});

/* prev / next note navigation */
document.getElementById('prevNote').addEventListener('click', ()=>{
  if(!notes.length) return;
  notes.sort((a,b)=> b.updated - a.updated);
  const idx = notes.findIndex(n=>n.id===currentId);
  if(idx > 0){ currentId = notes[idx-1].id; loadCurrentToEditor(); showCopyNotice('å‰ã®ãƒãƒ¼ãƒˆã¸'); }
  else showCopyNotice('ã“ã‚ŒãŒæœ€æ–°ã®ãƒãƒ¼ãƒˆã§ã™');
});
document.getElementById('nextNote').addEventListener('click', ()=>{
  if(!notes.length) return;
  notes.sort((a,b)=> b.updated - a.updated);
  const idx = notes.findIndex(n=>n.id===currentId);
  if(idx < notes.length-1){ currentId = notes[idx+1].id; loadCurrentToEditor(); showCopyNotice('æ¬¡ã®ãƒãƒ¼ãƒˆã¸'); }
  else showCopyNotice('ã“ã‚ŒãŒæœ€å¤ã®ãƒãƒ¼ãƒˆã§ã™');
});

/* copy notice */
function showCopyNotice(text){
  const el = document.getElementById('copyNotice');
  el.textContent = text; el.style.opacity = 1;
  setTimeout(()=> el.style.opacity = 0, 1400);
}

/* Glossary data (same categories) */
const GLOSSARY = [
  { title:'ã‚»ã‚¯ã‚·ãƒ§ãƒ³å', items:[
    {eng:'[Intro]', jpn:'æ¥½æ›²ã®å°å…¥éƒ¨åˆ†'}, {eng:'[Verse]', jpn:'æ—¥æœ¬ã§ã¯ã€ŒAãƒ¡ãƒ­ã€'}, {eng:'[Pre-Chorus]', jpn:'ã‚µãƒ“ã«å°ãï¼ˆBãƒ¡ãƒ­ï¼‰'},
    {eng:'[Chorus]', jpn:'ã‚µãƒ“'}, {eng:'[Post-Chorus]', jpn:'ã‚µãƒ“ç›´å¾Œ'}, {eng:'[Bridge]', jpn:'Cãƒ¡ãƒ­é¢¨'}, {eng:'[Hook]', jpn:'ãƒ•ãƒƒã‚¯'},
    {eng:'[Solo]', jpn:'ã‚½ãƒ­'}, {eng:'[melodic interlude]', jpn:'é–“å¥'}, {eng:'[Break]', jpn:'ãƒ–ãƒ¬ã‚¤ã‚¯'}, {eng:'[Outro]', jpn:'ã‚¢ã‚¦ãƒˆãƒ­'},
    {eng:'[Refrain]', jpn:'ãƒªãƒ•ãƒ¬ã‚¤ãƒ³'}, {eng:'[Fade Out]', jpn:'ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ'} ] },
  { title:'ã‚¸ãƒ£ãƒ³ãƒ«', items:[
    {eng:'[J-pop]', jpn:'Jãƒãƒƒãƒ—'}, {eng:'[City pop]', jpn:'ã‚·ãƒ†ã‚£ãƒãƒƒãƒ—'}, {eng:'[Techno pop]', jpn:'ãƒ†ã‚¯ãƒãƒãƒƒãƒ—'},
    {eng:'[J-Rock]', jpn:'Jãƒ­ãƒƒã‚¯'}, {eng:'[Indie rock]', jpn:'ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼ãƒ­ãƒƒã‚¯'}, {eng:'[Shoegaze]', jpn:'ã‚·ãƒ¥ãƒ¼ã‚²ã‚¤ã‚º'} ] },
  { title:'ãƒ­ãƒƒã‚¯ç³»', items:[
    {eng:'[Metal]', jpn:'ãƒ¡ã‚¿ãƒ«'}, {eng:'[Hard rock]', jpn:'ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯'}, {eng:'[Post-rock]', jpn:'ãƒã‚¹ãƒˆãƒ­ãƒƒã‚¯'}, {eng:'[Math rock]', jpn:'ãƒã‚¹ãƒ­ãƒƒã‚¯'} ] },
  { title:'ãƒ©ãƒƒãƒ—/R&B', items:[
    {eng:'[Rap]', jpn:'ãƒ©ãƒƒãƒ—'}, {eng:'[Hip-hop]', jpn:'ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—'}, {eng:'[Trap]', jpn:'ãƒˆãƒ©ãƒƒãƒ—'}, {eng:'[R&B]', jpn:'R&B'}, {eng:'[Neo soul]', jpn:'ãƒã‚ªã‚½ã‚¦ãƒ«'} ] },
  { title:'ã‚¸ãƒ£ã‚º/ã‚¯ãƒ©ã‚·ãƒƒã‚¯', items:[
    {eng:'[Jazz]', jpn:'ã‚¸ãƒ£ã‚º'}, {eng:'[Bebop]', jpn:'ãƒ“ãƒãƒƒãƒ—'}, {eng:'[Swing]', jpn:'ã‚¹ã‚¦ã‚£ãƒ³ã‚°'}, {eng:'[Classical]', jpn:'ã‚¯ãƒ©ã‚·ãƒƒã‚¯'} ] },
  { title:'ãƒ†ãƒ³ãƒ/æ„Ÿæƒ…', items:[
    {eng:'[Slow tempo]', jpn:'é…ã„ãƒ†ãƒ³ãƒ'}, {eng:'[Fast tempo]', jpn:'é€Ÿã„ãƒ†ãƒ³ãƒ'}, {eng:'[Joyful]', jpn:'æ˜ã‚‹ã„'}, {eng:'[Melancholic]', jpn:'æ†‚é¬±'} ] },
  { title:'ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ‹ãƒƒã‚¯', items:[
    {eng:'[Electronic]', jpn:'ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ‹ãƒƒã‚¯'}, {eng:'[EDM]', jpn:'EDM'}, {eng:'[House]', jpn:'ãƒã‚¦ã‚¹'}, {eng:'[Lo-fi]', jpn:'ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤'} ] }
];

const glossaryEl = document.getElementById('glossary');
const glossSection = document.getElementById('glossarySection');
const searchInput = document.getElementById('glossSearch');

function renderGloss(q=''){
  glossaryEl.innerHTML = '';
  const ql = (q||'').toLowerCase();
  GLOSSARY.forEach(cat=>{
    const card = document.createElement('div'); card.className='g-card';
    const t = document.createElement('div'); t.className='g-title'; t.textContent = cat.title;
    card.appendChild(t);
    const row = document.createElement('div');
    cat.items.forEach(it=>{
      const text = `${it.eng} ${it.jpn}`;
      if(ql && ! (text.toLowerCase().includes(ql) || it.eng.toLowerCase().includes(ql) || (it.jpn||'').toLowerCase().includes(ql)) ) return;
      const term = document.createElement('button'); term.className='term';
      term.innerHTML = `<span class="eng">${it.eng}</span><span class="jpn">${it.jpn}</span>`;
      term.addEventListener('click', ()=>{ navigator.clipboard.writeText(it.eng).then(()=> showCopyNotice(it.eng + ' ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); });
      row.appendChild(term);
    });
    card.appendChild(row);
    glossaryEl.appendChild(card);
  });
}
searchInput && searchInput.addEventListener('input', ()=> renderGloss(searchInput.value));
renderGloss();

/* open glossary in new tab */
document.getElementById('openGlossNewTab').addEventListener('click', ()=>{
  const url = window.location.href.split('#')[0] + '#glossary';
  window.open(url,'_blank');
});
/* jump in same page */
document.getElementById('jumpGloss').addEventListener('click', ()=> {
  // show section overlay
  glossSection.style.display = 'block';
  glossSection.scrollIntoView({behavior:'smooth'});
});
document.getElementById('backToEditor').addEventListener('click', ()=> {
  glossSection.style.display = 'none';
});

/* on load, if hash = #glossary, show glossary (useful when opened in new tab) */
if(window.location.hash === '#glossary'){ glossSection.style.display = 'block'; window.scrollTo(0,0); }

/* initial */
initNotes();
loadCurrentToEditor();

/* close sidebar on outside click for mobile */
document.addEventListener('click', (e)=>{
  if(window.innerWidth > 900) return;
  const sb = document.getElementById('sidebar');
  if(!sb) return;
  if(e.target.closest('#sidebar') || e.target.closest('.top-actions')) return;
  sb.style.display = 'none';
});
/* accessibility: focus handling - keep stable */
[verse1,verse2].forEach(t => {
  t.addEventListener('focus', ()=> { /* do nothing â€” keep layout stable */ });
});

</script>
</body>
</html>
