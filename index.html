<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>Suno æ­Œè©ãƒ¡ãƒ¢ï¼ˆDark / æ”¹è‰¯ç‰ˆï¼‰</title>
<style>
  :root{
    --bg:#0b0b0b; --card:#111; --muted:#9aa1a6; --accent:#2aa198; --border:#222;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%; margin:0; font-family:-apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN","Noto Sans JP", "Helvetica Neue", Arial; background:var(--bg); color:#fff; -webkit-font-smoothing:antialiased;}
  /* fixed header for stability when keyboard appears */
  header{position:fixed; top:0; left:0; right:0; height:56px; display:flex; align-items:center; gap:8px; padding:8px 12px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-bottom:1px solid var(--border); z-index:40;}
  .title{font-weight:700; font-size:16px;}
  .icon-btn{background:transparent; border:0; color:inherit; font-size:18px; padding:8px; border-radius:8px; cursor:pointer;}
  .icon-btn:active{transform:translateY(1px);}
  .small-muted{color:var(--muted); font-size:13px;}
  /* layout */
  .container{display:flex; height:100vh; padding-top:56px; box-sizing:border-box; overflow:hidden;}
  .sidebar{width:260px; min-width:200px; background:var(--card); border-right:1px solid var(--border); padding:10px; box-sizing:border-box; overflow:auto;}
  .main{flex:1; display:flex; gap:8px; padding:12px; box-sizing:border-box; align-items:stretch;}
  /* lyric boxes (full height) */
  .lyric-box{flex:1; display:flex; flex-direction:column; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:10px; border:1px solid var(--border); overflow:hidden; min-width:0;}
  .lyric-header{display:flex; align-items:center; justify-content:space-between; padding:10px; border-bottom:1px solid rgba(255,255,255,0.03);}
  .lyric-title{font-weight:700;}
  .toolbar{display:flex; gap:8px; align-items:center;}
  /* ensure textarea font-size >=16 to prevent iOS auto-zoom */
  textarea{background:transparent; border:0; color:#fff; padding:12px; font-size:16px; line-height:1.6; resize:none; width:100%; height:100%; box-sizing:border-box; outline:none;}
  .lyric-text{flex:1; min-height:0; overflow:auto;}
  /* prompt collapsed bar */
  .prompt-bar{display:flex; align-items:center; justify-content:space-between; padding:8px 10px; border-radius:8px; background:var(--glass); border:1px solid var(--border); cursor:pointer;}
  .prompt-expanded{margin-top:8px; border-radius:8px; border:1px solid var(--border); background:var(--card); padding:8px;}
  input, button, textarea { -webkit-tap-highlight-color: rgba(255,255,255,0.06); }
  /* notes list */
  .notes-list{display:flex; flex-direction:column; gap:8px; margin-top:8px;}
  .note-item{padding:8px; background:transparent; border-radius:8px; border:1px solid transparent; cursor:pointer; display:flex; justify-content:space-between; align-items:center;}
  .note-item.active{border-color:rgba(42,161,152,0.22); background:linear-gradient(90deg, rgba(42,161,152,0.03), transparent);}
  .controls{display:flex; gap:8px; margin-top:10px;}
  .btn{background:transparent; border:1px solid var(--border); color:inherit; padding:6px 8px; border-radius:8px; cursor:pointer;}
  .footer{position:fixed; left:0; right:0; bottom:0; padding:8px 12px; background:linear-gradient(0deg, rgba(0,0,0,0.6), transparent); display:flex; justify-content:space-between; gap:8px; z-index:40; border-top:1px solid var(--border);}
  /* modal glossary */
  .modal{position:fixed; left:0; right:0; top:56px; bottom:56px; margin:auto; background:rgba(2,2,2,0.9); border-radius:8px; padding:12px; box-sizing:border-box; z-index:50; display:none; overflow:auto; border:1px solid rgba(255,255,255,0.04);}
  .modal.open{display:block;}
  .g-card{background:transparent; border:1px solid rgba(255,255,255,0.03); padding:10px; border-radius:8px; margin-bottom:10px;}
  .term{display:inline-block; padding:6px 8px; border-radius:6px; background:rgba(255,255,255,0.02); margin:4px; cursor:pointer; border:1px solid rgba(255,255,255,0.02);}
  .copy-notice{position:fixed; left:50%; transform:translateX(-50%); bottom:70px; background:#111; color:#fff; padding:8px 12px; border-radius:18px; opacity:0; transition:opacity .2s; z-index:60;}
  /* responsive: hide sidebar on very small */
  @media (max-width:880px){
    .sidebar{display:none;}
    .main{padding:10px;}
    .modal{left:6px; right:6px; top:66px; bottom:66px;}
  }
</style>
</head>
<body>

<header>
  <button id="prevNote" class="icon-btn" title="å‰ã®ãƒãƒ¼ãƒˆï¼ˆâ†ï¼‰">â†</button>
  <button id="nextNote" class="icon-btn" title="æ¬¡ã®ãƒãƒ¼ãƒˆï¼ˆâ†’ï¼‰">â†’</button>
  <div class="title">Suno æ­Œè©ãƒ¡ãƒ¢</div>
  <div style="flex:1"></div>
  <div class="small-muted" id="status">è‡ªå‹•ä¿å­˜</div>
  <button id="openGloss" class="icon-btn" title="ç”¨èªé›†ï¼ˆåˆ¥ã‚¿ãƒ–ã§é–‹ãã“ã¨ã‚‚å¯èƒ½ï¼‰">ç”¨èªé›†</button>
  <button id="openGlossNewTab" class="icon-btn" title="ç”¨èªé›†ã‚’åˆ¥ã‚¿ãƒ–ã§é–‹ã">â†—</button>
</header>

<div class="container">
  <aside class="sidebar" id="sidebar">
    <div style="display:flex; gap:8px;">
      <input id="newNoteName" placeholder="æ–°ã—ã„ãƒãƒ¼ãƒˆå" style="flex:1; padding:8px; border-radius:8px; background:transparent; border:1px solid var(--border); color:#fff;">
      <button id="createNote" class="btn">ä½œæˆ</button>
    </div>

    <div class="notes-list" id="notesList" aria-live="polite"></div>

    <div class="controls">
      <button id="exportAll" class="btn">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <label class="btn" style="cursor:pointer;">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ <input id="importFile" type="file" accept="application/json" style="display:none;"></label>
    </div>
  </aside>

  <main class="main">
    <!-- Left verse -->
    <section class="lyric-box" id="leftBox">
      <div class="lyric-header">
        <div class="lyric-title">â‘  1ç•ªï¼ˆå·¦ï¼‰</div>
        <div class="toolbar">
          <button id="copyVerse1" class="icon-btn" title="ã‚³ãƒ”ãƒ¼ï¼ˆâï¼‰">â</button>
          <button id="clearVerse1" class="icon-btn" title="æ¶ˆå»ï¼ˆğŸ—‘ï¸ï¼‰">ğŸ—‘ï¸</button>
        </div>
      </div>
      <div class="lyric-text"><textarea id="verse1" placeholder="1ç•ªã®æ­Œè©ã‚’ã“ã“ã«æ›¸ã" spellcheck="true" autocomplete="off"></textarea></div>
    </section>

    <!-- Right verse -->
    <section class="lyric-box" id="rightBox">
      <div class="lyric-header">
        <div class="lyric-title">â‘¡ 2ç•ªï¼ˆå³ï¼‰</div>
        <div class="toolbar">
          <button id="copyVerse2" class="icon-btn" title="ã‚³ãƒ”ãƒ¼ï¼ˆâï¼‰">â</button>
          <button id="clearVerse2" class="icon-btn" title="æ¶ˆå»ï¼ˆğŸ—‘ï¸ï¼‰">ğŸ—‘ï¸</button>
        </div>
      </div>
      <div class="lyric-text"><textarea id="verse2" placeholder="2ç•ªã®æ­Œè©ã‚’ã“ã“ã«æ›¸ã" spellcheck="true" autocomplete="off"></textarea></div>
    </section>
  </main>
</div>

<!-- prompt collapsed / expanded (fixed at bottom-left area above footer) -->
<div style="position:fixed; left:14px; bottom:74px; width:320px; z-index:45;">
  <div id="promptBar" class="prompt-bar" title="ã‚¿ãƒƒãƒ—ã§å±•é–‹/æ ¼ç´">
    <div id="promptLabel">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¡ãƒ¢</div>
    <div id="promptToggle">â–¾</div>
  </div>
  <div id="promptExpanded" class="prompt-expanded" style="display:none;">
    <textarea id="promptText" rows="4" placeholder="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›¸ã„ã¦ãã ã•ã„ï¼ˆ16pxä»¥ä¸Šã®ãƒ•ã‚©ãƒ³ãƒˆã§iOSã®æ‹¡å¤§ã‚’é˜²ãã¾ã™ï¼‰"></textarea>
    <div style="margin-top:6px; display:flex; gap:8px;">
      <button id="copyPrompt" class="btn">â ã‚³ãƒ”ãƒ¼</button>
      <button id="clearPrompt" class="btn">ğŸ—‘ï¸ æ¶ˆå»</button>
    </div>
  </div>
</div>

<!-- footer -->
<div class="footer">
  <div class="small-muted">ãƒãƒ¼ãƒˆ: <span id="currentName">ï¼ˆæœªé¸æŠï¼‰</span></div>
  <div style="display:flex; gap:8px;">
    <button id="renameNote" class="btn" title="åå‰å¤‰æ›´">âœ</button>
    <button id="deleteNote" class="btn" title="ãƒãƒ¼ãƒˆå‰Šé™¤">ğŸ—‘ï¸</button>
    <button id="downloadNote" class="btn" title="ç¾åœ¨ãƒãƒ¼ãƒˆã‚’ä¿å­˜ï¼ˆJSONï¼‰">ä¿å­˜</button>
  </div>
</div>

<!-- glossary modal -->
<div id="glossModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <div style="font-weight:700">éŸ³æ¥½ç”¨èªé›†ï¼ˆã‚¿ãƒƒãƒ—ã§ [è‹±èª] ã‚’ã‚³ãƒ”ãƒ¼ï¼‰</div>
    <div>
      <button id="closeGloss" class="btn">é–‰ã˜ã‚‹</button>
    </div>
  </div>
  <div id="glossaryContent"></div>
</div>

<div id="copyNotice" class="copy-notice">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

<script>
/* ========== Storage & initial notes ========== */
const STORAGE_KEY = 'suno_memo_dark_v1';
let notes = [];
let currentIndex = 0;

function initNotes(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    try{ notes = JSON.parse(raw); } catch(e){ notes=[]; }
  }
  if(!notes || notes.length===0){
    const now = Date.now();
    notes = [{ id: 'note-'+now, name:'æ–°ã—ã„ãƒãƒ¼ãƒˆ', verse1:'', verse2:'', prompt:'' }];
    currentIndex = 0;
    saveAll();
  } else {
    currentIndex = 0;
  }
  renderNotesList();
  loadCurrent();
}

function saveAll(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
  document.getElementById('status').textContent = 'è‡ªå‹•ä¿å­˜ ' + new Date().toLocaleTimeString();
  renderNotesList();
}

/* ========== UI: notes list ========== */
const notesListEl = document.getElementById('notesList');
function renderNotesList(){
  notesListEl.innerHTML = '';
  notes.forEach((n,i)=>{
    const el = document.createElement('div');
    el.className = 'note-item' + (i===currentIndex ? ' active' : '');
    el.innerHTML = `<div style="flex:1;"><strong>${escapeHtml(n.name)}</strong></div>
      <div style="display:flex; gap:6px;">
        <button class="btn" data-index="${i}" data-action="open">é–‹</button>
        <button class="btn" data-index="${i}" data-action="dup">è¤‡</button>
      </div>`;
    notesListEl.appendChild(el);
  });
}
notesListEl.addEventListener('click', (e)=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  const i = Number(btn.dataset.index);
  const a = btn.dataset.action;
  if(a==='open'){ currentIndex = i; loadCurrent(); }
  if(a==='dup'){ const copy = {...notes[i], id:'note-'+Date.now(), name: notes[i].name + 'ï¼ˆè¤‡è£½ï¼‰'}; notes.splice(i+1,0,copy); currentIndex = i+1; saveAll(); loadCurrent(); }
});

/* helpers */
function escapeHtml(s){ return (s||'').replace(/[<>&"]/g,c=>({ '<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;' })[c]); }

/* create note */
document.getElementById('createNote').addEventListener('click', ()=>{
  const name = (document.getElementById('newNoteName').value || '').trim() || 'æ–°ã—ã„ãƒãƒ¼ãƒˆ';
  const id = 'note-'+Date.now();
  notes.push({id,name, verse1:'', verse2:'', prompt:''});
  currentIndex = notes.length-1;
  document.getElementById('newNoteName').value = '';
  saveAll(); loadCurrent();
});

/* rename/delete/prev/next */
document.getElementById('renameNote').addEventListener('click', ()=>{
  const n = notes[currentIndex];
  const nm = prompt('ãƒãƒ¼ãƒˆåã‚’å…¥åŠ›', n.name);
  if(nm!==null){ n.name = nm||'ç„¡é¡Œ'; saveAll(); renderNotesList(); document.getElementById('currentName').textContent = n.name; }
});
document.getElementById('deleteNote').addEventListener('click', ()=>{
  if(!confirm('æœ¬å½“ã«ã“ã®ãƒãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
  notes.splice(currentIndex,1);
  if(notes.length===0){ notes.push({id:'note-'+Date.now(), name:'æ–°ã—ã„ãƒãƒ¼ãƒˆ', verse1:'', verse2:'', prompt:''}); currentIndex=0; }
  else if(currentIndex >= notes.length) currentIndex = notes.length-1;
  saveAll(); loadCurrent();
});
document.getElementById('prevNote').addEventListener('click', ()=> {
  if(currentIndex>0){ currentIndex--; loadCurrent(); }
});
document.getElementById('nextNote').addEventListener('click', ()=> {
  if(currentIndex < notes.length-1){ currentIndex++; loadCurrent(); }
});

/* export/import/download */
document.getElementById('exportAll').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(notes, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='suno_memo_all.json'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('importFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=> {
    try{
      const data = JSON.parse(reader.result);
      if(Array.isArray(data)){ notes = data; currentIndex = 0; saveAll(); loadCurrent(); alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†'); }
      else alert('JSONé…åˆ—ã‚’é¸ã‚“ã§ãã ã•ã„');
    }catch(err){ alert('èª­ã¿è¾¼ã¿å¤±æ•—: '+err.message); }
  };
  reader.readAsText(f);
});
document.getElementById('downloadNote').addEventListener('click', ()=>{
  const n = notes[currentIndex]; const blob = new Blob([JSON.stringify(n, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download=(n.name||'note')+'.json'; a.click(); URL.revokeObjectURL(url);
});

/* load into editor */
const verse1El = document.getElementById('verse1');
const verse2El = document.getElementById('verse2');
const promptText = document.getElementById('promptText');

function loadCurrent(){
  const n = notes[currentIndex];
  verse1El.value = n.verse1 || '';
  verse2El.value = n.verse2 || '';
  promptText.value = n.prompt || '';
  document.getElementById('currentName').textContent = n.name || 'ï¼ˆç„¡é¡Œï¼‰';
  renderNotesList();
  saveAll();
}

/* auto-save on input (debounced) */
let saveTimer = null;
[verse1El, verse2El, promptText].forEach(el=>{
  el.addEventListener('input', ()=> {
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(()=> {
      const n = notes[currentIndex];
      if(!n) return;
      n.verse1 = verse1El.value;
      n.verse2 = verse2El.value;
      n.prompt = promptText.value;
      saveAll();
    }, 500);
  });
});

/* copy & clear with confirmations */
function showCopy(text){
  const el = document.getElementById('copyNotice');
  el.textContent = text; el.style.opacity = 1;
  setTimeout(()=> el.style.opacity = 0, 1400);
}
document.getElementById('copyVerse1').addEventListener('click', ()=> {
  navigator.clipboard.writeText(verse1El.value || '').then(()=> showCopy('1ç•ªã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
});
document.getElementById('copyVerse2').addEventListener('click', ()=> {
  navigator.clipboard.writeText(verse2El.value || '').then(()=> showCopy('2ç•ªã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
});
document.getElementById('copyPrompt').addEventListener('click', ()=> {
  navigator.clipboard.writeText(promptText.value || '').then(()=> showCopy('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
});

document.getElementById('clearVerse1').addEventListener('click', ()=> {
  if(!verse1El.value) return showCopy('1ç•ªã¯æ—¢ã«ç©ºã§ã™');
  if(confirm('1ç•ªã®å†…å®¹ã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')){ verse1El.value=''; verse1El.dispatchEvent(new Event('input')); showCopy('1ç•ªã‚’æ¶ˆå»ã—ã¾ã—ãŸ'); }
});
document.getElementById('clearVerse2').addEventListener('click', ()=> {
  if(!verse2El.value) return showCopy('2ç•ªã¯æ—¢ã«ç©ºã§ã™');
  if(confirm('2ç•ªã®å†…å®¹ã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')){ verse2El.value=''; verse2El.dispatchEvent(new Event('input')); showCopy('2ç•ªã‚’æ¶ˆå»ã—ã¾ã—ãŸ'); }
});
document.getElementById('clearPrompt').addEventListener('click', ()=> {
  if(!promptText.value) return showCopy('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯æ—¢ã«ç©ºã§ã™');
  if(confirm('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ')){ promptText.value=''; promptText.dispatchEvent(new Event('input')); showCopy('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ¶ˆå»ã—ã¾ã—ãŸ'); }
});

/* prompt collapse/expand */
const promptBar = document.getElementById('promptBar');
const promptExpanded = document.getElementById('promptExpanded');
const promptToggle = document.getElementById('promptToggle');
let promptOpen = false;
promptBar.addEventListener('click', ()=> {
  promptOpen = !promptOpen;
  promptExpanded.style.display = promptOpen ? 'block' : 'none';
  promptToggle.textContent = promptOpen ? 'â–´' : 'â–¾';
});

/* glossary modal (no swipe) */
const glossModal = document.getElementById('glossModal');
const glossContent = document.getElementById('glossaryContent');
const openGlossBtn = document.getElementById('openGloss');
const openGlossNewTabBtn = document.getElementById('openGlossNewTab');
openGlossBtn.addEventListener('click', ()=> {
  glossModal.classList.add('open'); glossModal.setAttribute('aria-hidden','false');
});
document.getElementById('closeGloss').addEventListener('click', ()=> {
  glossModal.classList.remove('open'); glossModal.setAttribute('aria-hidden','true');
});
openGlossNewTabBtn.addEventListener('click', ()=> {
  // generate a simple HTML blob for glossary and open in new tab
  const html = buildGlossaryHTML(true);
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=> URL.revokeObjectURL(url), 5000);
});

/* glossary data (same categories) */
const GLOSSARY = [
  { title:'ã‚»ã‚¯ã‚·ãƒ§ãƒ³å', items:[
      {eng:'[Intro]', jpn:'æ¥½æ›²ã®å°å…¥éƒ¨åˆ†'},
      {eng:'[Verse]', jpn:'æ—¥æœ¬ã§ã¯ã€ŒAãƒ¡ãƒ­ã€ã¨å‘¼ã°ã‚Œã‚‹éƒ¨åˆ†'},
      {eng:'[Pre-Chorus]', jpn:'ã‚µãƒ“ã«å°ãã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆBãƒ¡ãƒ­ï¼‰'},
      {eng:'[Chorus]', jpn:'ã‚µãƒ“'},
      {eng:'[Post-Chorus]', jpn:'ã‚µãƒ“ã®ç›´å¾Œ'},
      {eng:'[Bridge]', jpn:'Cãƒ¡ãƒ­ã«è¿‘ã„'},
      {eng:'[Hook]', jpn:'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªã‚µãƒ“è¡¨ç¾'},
      {eng:'[Solo]', jpn:'æ¥½å™¨ã®ã‚½ãƒ­'},
      {eng:'[melodic interlude]', jpn:'é–“å¥'},
      {eng:'[Break]', jpn:'ä¼‘ç¬¦ã‚„ãƒ–ãƒ¬ã‚¤ã‚¯'},
      {eng:'[Percussion Break]', jpn:'æ‰“æ¥½å™¨ã®ãƒ–ãƒ¬ã‚¤ã‚¯'},
      {eng:'[Call and response]', jpn:'ã‚³ãƒ¼ãƒ«ï¼†ãƒ¬ã‚¹ãƒãƒ³ã‚¹'},
      {eng:'[Shout]', jpn:'ã‚·ãƒ£ã‚¦ãƒˆ'},
      {eng:'[Outro]', jpn:'æ›²ã®çµ‚ã‚ã‚Š'},
      {eng:'[Refrain]', jpn:'ãƒªãƒ•ãƒ¬ã‚¤ãƒ³'},
      {eng:'[Big Finish]', jpn:'ç››ã‚Šä¸Šã’ã¦çµ‚ã‚ã‚‹'},
      {eng:'[End]', jpn:'çµ‚äº†'},
      {eng:'[Fade Out]', jpn:'ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã§çµ‚ã‚ã‚‹'},
      {eng:'[Fade to End]', jpn:'ãƒ•ã‚§ãƒ¼ãƒ‰ã—ã¦çµ‚ã‚ã‚‹'}
  ]},
  { title:'ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆè‹±ï¼æ—¥ï¼‰', items:[
      {eng:'[J-pop]', jpn:'Jãƒãƒƒãƒ—ï¼šæ—¥æœ¬ã®ãƒãƒƒãƒ—'},
      {eng:'[Techno pop]', jpn:'ãƒ†ã‚¯ãƒãƒãƒƒãƒ—'},
      {eng:'[City pop]', jpn:'ã‚·ãƒ†ã‚£ãƒãƒƒãƒ—'},
      {eng:'[Anime song]', jpn:'ã‚¢ãƒ‹ã‚½ãƒ³'},
      {eng:'[J-Rock]', jpn:'Jãƒ­ãƒƒã‚¯'},
      {eng:'[Indie rock]', jpn:'ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼ãƒ­ãƒƒã‚¯'},
      {eng:'[Pop punk]', jpn:'ãƒãƒƒãƒ—ãƒ‘ãƒ³ã‚¯'},
      {eng:'[Shoegaze]', jpn:'ã‚·ãƒ¥ãƒ¼ã‚²ã‚¤ã‚º'}
  ]},
  { title:'ãƒ­ãƒƒã‚¯ï¼ãƒ¡ã‚¿ãƒ«ç³»', items:[
      {eng:'[Metal]', jpn:'ãƒ¡ã‚¿ãƒ«'}, {eng:'[Hard rock]', jpn:'ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯'},
      {eng:'[Punk rock]', jpn:'ãƒ‘ãƒ³ã‚¯ãƒ­ãƒƒã‚¯'}, {eng:'[Post-rock]', jpn:'ãƒã‚¹ãƒˆãƒ­ãƒƒã‚¯'},
      {eng:'[Math rock]', jpn:'ãƒã‚¹ãƒ­ãƒƒã‚¯'}
  ]},
  { title:'ãƒ©ãƒƒãƒ—ï¼R&Bç³»', items:[
      {eng:'[Rap]', jpn:'ãƒ©ãƒƒãƒ—'}, {eng:'[Hip-hop]', jpn:'ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—'}, {eng:'[Trap]', jpn:'ãƒˆãƒ©ãƒƒãƒ—'},
      {eng:'[R&B]', jpn:'R&B'}, {eng:'[Neo soul]', jpn:'ãƒã‚ªã‚½ã‚¦ãƒ«'}
  ]},
  { title:'ã‚¸ãƒ£ã‚ºï¼ã‚¯ãƒ©ã‚·ãƒƒã‚¯ç³»', items:[
      {eng:'[Jazz]', jpn:'ã‚¸ãƒ£ã‚º'}, {eng:'[Bebop]', jpn:'ãƒ“ãƒãƒƒãƒ—'}, {eng:'[Swing]', jpn:'ã‚¹ã‚¦ã‚£ãƒ³ã‚°'},
      {eng:'[Classical]', jpn:'ã‚¯ãƒ©ã‚·ãƒƒã‚¯'}, {eng:'[Baroque]', jpn:'ãƒãƒ­ãƒƒã‚¯'}, {eng:'[Minimal music]', jpn:'ãƒŸãƒ‹ãƒãƒ«'}
  ]},
  { title:'è¡¨ç¾ãƒ»ãƒ†ãƒ³ãƒ', items:[
      {eng:'[Slow tempo]', jpn:'é…ã„ãƒ†ãƒ³ãƒ'}, {eng:'[Medium tempo]', jpn:'ä¸­ãƒ†ãƒ³ãƒ'}, {eng:'[Fast tempo]', jpn:'é€Ÿã„ãƒ†ãƒ³ãƒ'},
      {eng:'[Joyful]', jpn:'æ˜ã‚‹ã„'}, {eng:'[Melancholic]', jpn:'æ†‚é¬±'}, {eng:'[Energetic]', jpn:'å…ƒæ°—ãª'},
      {eng:'[Romantic]', jpn:'ãƒ­ãƒãƒ³ãƒãƒƒã‚¯'}, {eng:'[Calm]', jpn:'ç©ã‚„ã‹'}, {eng:'[Aggressive]', jpn:'ã‚¢ã‚°ãƒ¬ãƒƒã‚·ãƒ–'},
      {eng:'[Inspirational]', jpn:'æ„Ÿå‹•çš„'}, {eng:'[Mysterious]', jpn:'ç¥ç§˜çš„'}
  ]},
  { title:'ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ‹ãƒƒã‚¯ç³»', items:[
      {eng:'[Electronic]', jpn:'ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ‹ãƒƒã‚¯'}, {eng:'[EDM]', jpn:'EDM'}, {eng:'[House]', jpn:'ãƒã‚¦ã‚¹'},
      {eng:'[Techno]', jpn:'ãƒ†ã‚¯ãƒ'}, {eng:'[Trance]', jpn:'ãƒˆãƒ©ãƒ³ã‚¹'}, {eng:'[Dubstep]', jpn:'ãƒ€ãƒ–ã‚¹ãƒ†ãƒƒãƒ—'}, {eng:'[Lo-fi]', jpn:'ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤'}
  ]}
];

function buildGlossaryHTML(forNewTab=false){
  let html = '<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ç”¨èªé›†</title><style>body{background:#000;color:#fff;font-family:-apple-system;margin:12px} .term{display:inline-block;padding:6px 8px;border-radius:6px;background:#111;margin:6px;border:1px solid #222;cursor:pointer} .h{font-weight:700;margin-top:16px}</style></head><body>';
  html += '<h1>éŸ³æ¥½ç”¨èªé›†</h1>';
  GLOSSARY.forEach(cat=>{
    html += `<div class="h">${cat.title}</div><div>`;
    cat.items.forEach(it=>{
      html += `<button class="term" onclick="navigator.clipboard.writeText('${it.eng.replace(/'/g,"\\'")}')">${it.eng} <div style="font-size:12px;color:#9aa1a6">${it.jpn}</div></button>`;
    });
    html += '</div>';
  });
  html += '<p style="color:#9aa1a6">ã‚¿ãƒƒãƒ—ã§ [è‹±èª] ã‚’ã‚³ãƒ”ãƒ¼</p></body></html>';
  return html;
}

/* render glossary modal */
function renderGlossary(){
  glossContent.innerHTML = '';
  GLOSSARY.forEach(cat=>{
    const card = document.createElement('div'); card.className='g-card';
    const h = document.createElement('div'); h.style.fontWeight='700'; h.textContent = cat.title;
    card.appendChild(h);
    const row = document.createElement('div');
    cat.items.forEach(it=>{
      const b = document.createElement('button'); b.className='term';
      b.innerHTML = `<div style="font-weight:700">${it.eng}</div><div style="font-size:12px;color:var(--muted)">${it.jpn}</div>`;
      b.addEventListener('click', ()=> {
        navigator.clipboard.writeText(it.eng).then(()=> showCopy(it.eng + ' ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
      });
      row.appendChild(b);
    });
    card.appendChild(row);
    glossContent.appendChild(card);
  });
}
renderGlossary();

/* disable swipe navigation previously used */
/* nothing to do: no swipe handlers */

/* init & start */
initNotes();

/* close sidebar on click outside for small screens - already sidebar hidden via CSS */
/* done */

/* prevent iOS from zooming on focus by ensuring font-size >= 16px (done in CSS) */

</script>
</body>
</html>
